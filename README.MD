# HalseyBot - Azure Container App

This project is a Python bot that monitors a website for product changes and posts updates to Twitter. It runs continuously on Azure Container Apps using a Dockerized container.

---

## ðŸš€ Project Structure

```
HalseyBot/
â”œâ”€â”€ main.py               # The main async bot logic
â”œâ”€â”€ requirements.txt      # Python dependencies
â”œâ”€â”€ Dockerfile            # Defines the container image
â”œâ”€â”€ .env (local)          # Environment variables (not committed)
â””â”€â”€ README.md             # You're reading it!
```

---

## ðŸ” Redeploying After Code Changes

The deploy.sh script can be ran to build, tag, push and deploy code changes

```bash
./deploy.sh
```

Note: If the file is not executable you must run the following first:

```bash
chmod +x deploy.sh
```

---

## ðŸ” Redeploying After Code Changes (Manually)

Whenever you make changes to the botâ€™s code and want to redeploy it to Azure, follow these steps:

### âœ… 1. Rebuild the Docker image (targeting `linux/amd64`)
```bash
docker build --platform linux/amd64 -t halseybot .
```

### âœ… 2. Tag the image for Azure Container Registry
```bash
docker tag halseybot halseybotacr.azurecr.io/halseybot:latest
```

### âœ… 3. Push the image to Azure Container Registry
```bash
az acr login --name halseybotacr
docker push halseybotacr.azurecr.io/halseybot:latest
```

### âœ… 4. Update the Azure Container App
```bash
az containerapp update \
  --name halseybot \
  --resource-group halseybot-rg \
  --image halseybotacr.azurecr.io/halseybot:latest
```

---

## ðŸ” Environment Variables

Environment variables like the Azure Blob Storage connection string should be passed securely.

### Set environment variable in Azure:
```bash
az containerapp update \
  --name halseybot \
  --resource-group halseybot-rg \
  --set-env-vars AZURE_STORAGE_CONNECTION_STRING="your-connection-string"
```

In code (`main.py`):
```python
import os
CONNECTION_STRING = os.getenv("AZURE_STORAGE_CONNECTION_STRING")
```

---

## ðŸ“¦ Dependency Management

To add new Python packages:

1. Install locally:
```bash
pip install somepackage
```

2. Freeze the updated list:
```bash
pip freeze > requirements.txt
```

3. Rebuild and redeploy the container as described above.

---

## ðŸ§ª Running Locally

You can also test the bot locally with:

```bash
python main.py
```

To use your `.env` file:
```bash
pip install python-dotenv
```

Then load it in `main.py`:
```python
from dotenv import load_dotenv
load_dotenv()
```

---

## ðŸ“– Logs & Monitoring

View container logs in real-time:

```bash
az containerapp logs show \
  --name halseybot \
  --resource-group halseybot-rg \
  --follow
```

---

## âœ… Notes

- Make sure your Docker image is always built for `linux/amd64` (Azure requirement).
- Avoid hardcoding secrets â€” use environment variables or managed identities.
- Azure Container Apps will keep your bot running continuously unless the app crashes or is updated.
